{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Description": "Sample CloudFormation Template for CSYE 6225 - Fall 2017",
    "Resources": {
         
        "EC2InstanceSG": {
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": {
            "GroupDescription": "Sample EC2Instabce security group",
            "GroupName":"csye6225-webapp",
            "VpcId":{"Ref":"ParamVpcID"}
                          }
                         },
        "RDSSG": {
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": {
            "GroupDescription": "Sample RDS security group",
            "GroupName":"csye6225-rds",
            "VpcId":{"Ref":"ParamVpcID"}
                           }
                 },
        "RDS2SG":{
           
        },
       "EC2InstanceSGInboundRule1": {
           "Type": "AWS::EC2::SecurityGroupIngress",
           "Properties":{
           "IpProtocol": "tcp",
           "FromPort": "22",
           "ToPort": "22",
           "CidrIp": "0.0.0.0/0",
           "GroupId": {"Fn::GetAtt": ["EC2InstanceSG", "GroupId"]}      
      }
    },
       "EC2InstanceSGInboundRule2": {
           "Type": "AWS::EC2::SecurityGroupIngress",
           "Properties":{
           "IpProtocol": "tcp",
           "FromPort": "80",
           "ToPort": "80",
           "CidrIp": "0.0.0.0/0",
           "GroupId": {"Fn::GetAtt": ["EC2InstanceSG", "GroupId"]}       
      }
    },
       "EC2InstanceSGInboundRule3": {
           "Type": "AWS::EC2::SecurityGroupIngress",
           "Properties":{
           "IpProtocol": "tcp",
           "FromPort": "443",
           "ToPort": "443",
           "CidrIp": "0.0.0.0/0",
           "GroupId": {"Fn::GetAtt": ["EC2InstanceSG", "GroupId"]}        
      }
    },
       "RDSSGInboundRule1": {
           "Type": "AWS::EC2::SecurityGroupIngress",
           "Properties":{
           "IpProtocol": "tcp",
           "FromPort": "3306",
           "ToPort": "3306",
           "SourceSecurityGroupId": {"Fn::GetAtt": ["EC2InstanceSG","GroupId"]},  
           "GroupId": {"Fn::GetAtt": ["RDSSG", "GroupId"]}     
      }
    },

  "DynamoDB":{
  "Type" : "AWS::DynamoDB::Table",
  "Properties" : {
    "AttributeDefinitions" : [{
            "AttributeName":"id",
            "AttributeType":"S"}],
    "KeySchema" : [{
        "AttributeName":"id",
        "KeyType":"HASH"}],
    "ProvisionedThroughput" : {
         "ReadCapacityUnits":"5",
         "WriteCapacityUnits":"5"},
    "TableName" : "csye6225"
}  
},
  
     "myDBSubnetGroup" : {
         "Type" : "AWS::RDS::DBSubnetGroup",
         "Properties" : {
            
            "DBSubnetGroupDescription" : "description",
            "SubnetIds" : [ "subnet-2615ea6d", "subnet-d9d875bd", "subnet-159cac4f", "subnet-3f428200" ]             
} 
},
     "DBInstance":{
          "Type" : "AWS::RDS::DBInstance",
         "Properties" :{
    "Engine" : "MySql",
    "EngineVersion" : "5.6.35",
    "DBInstanceClass" : "db.t2.medium",
    "MultiAZ":"false",
    "StorageType" : "standard",
    "AllocatedStorage" : "10",
    "DBInstanceIdentifier" : "csye6225-fall2017",
    "MasterUsername" : "csye6225master",
    "MasterUserPassword" : "csye6225password",
    "DBSubnetGroupName" : {"Ref":"myDBSubnetGroup"},
    "PubliclyAccessible" : "false",
    "DBName":"csye6225"
  }
}
    
   },
    "Parameters" : {
          "ParamVpcID" : {
            "Type" : "String"
       }
    }
}
