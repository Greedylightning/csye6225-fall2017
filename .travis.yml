  language: java

  jdk:
    - oraclejdk8

  sudo: false
  install: true

  before_script:
   - chmod +x gradlew
  script:
    - ./gradlew war
#    - ./gradlew war
    - gradle -Dtest.single=DemoApplicationTests test

  after_success:
    - mkdir codedeploy
    - zip -r csye6225-fall2017-${TRAVIS_JOB_NUMBER}.zip build/lib/libs/test-1.0.0.war appspec.yml restartTomcat.sh
    - ls -al
    - mv -csye6225-fall2017-${TRAVIS_JOB_NUMBER}.zip codedeploy/
    - ls -al
    - pwd
    - cd codedeploy
    - ls -al
    - pwd

  before_deploy:
    - cd ..

  deploy:
    - provider: s3
      access_key_id: AKIAJJK3DZ4DJRAQFZRQ
      secret_access_key:
        secure:
      local_dir: codedeploy
      bucket: csye6225-fall2017-xushua.me
      region: us-east-1
      skip_cleanup: true
      on:
        branch: assignment7

    - provider: codedeploy
      access_key_id: AKIAJJK3DZ4DJRAQFZRQ
      secret_access_key:
        secure: 
      bucket: csye6225-fall2017-xushua.me
      key: csye6225-fall2017-${TRAVIS_JOB_NUMBER}.zip
      bundle_type: zip
      application: csye6225-fall2017
      deployment_group: csye6225-fall2017
      region: us-east-1
      wait-until-deployed: true
      on:
        branch: assignment7

notifications:
  email:
    recipients:
      - zhang.mengf@husky.neu.edu
